<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Manage Products & Orders</title>
    <style>
        body {
            max-width: 100%;
            margin: 0;
        }

        .logo {
            max-width: 150px;
            margin: 20px auto;
        }

        footer {
            position: relative;
            left: 50%;
            transform: translateX(-50%);
        }

        .container {
            padding: 0 15px;
        }

        .table {
            width: 100%;
        }

        @media (max-width: 900px) {
            .table {
                display: block;
                overflow-x: auto;
            }
        }

        @media (max-width: 600px) {
            button {
                width: 100%;
            }
        }
    </style>
    
    <link rel="icon" href="https://i.ibb.co/r0cyvgJ/favicon-32x32.png" type="image/x-icon">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css">
</head>
<body>
<div class="container mt-5">
    <img src="https://i.ibb.co/mhCNWvK/IMG-20240121-WA0090.jpg" alt="Logo" class="logo">
    <h1 class="text-center">Admin - Manage Products & Orders</h1>

    <!-- Product Management Section -->
    <div id="admin-section" style="display: none;">
        <form id="product-form" class="mb-4">
            <div class="form-group">
                <label for="category">Product Type</label>
                <select id="category" class="form-control" required="">
                    <option value="" disabled="" selected="">Select Product Type</option>
                    <option value="Phone - Android">Android</option>
                    <option value="Phone - Iphone">Iphone</option>
                    <option value="Phone - Xiaomi">Xiaomi</option>
                    <option value="Phone - Tecno">Tecno</option>
                    <option value="Laptop - ASUS">Laptop - ASUS</option>
                    <option value="Laptop - HP">Laptop - HP</option>
                    <option value="Laptop - Dell">Laptop - Dell</option>
                    <option value="Accessory">Accessory</option>
                    <option value="Peripherals">Peripherals</option>
                </select>
            </div>
            <div class="form-group">
                <label for="name">Product Name <i class="bi bi-box"></i></label>
                <input type="text" id="name" class="form-control" required=""/>
            </div>
            <div class="form-group">
                <label for="price">Price <i class="bi bi-cash"></i></label>
                <input type="number" id="price" class="form-control" required=""/>
            </div>
            <div class="form-group">
                <label for="stock">Stock Availability <i class="bi bi-check-circle"></i></label>
                <input type="number" id="stock" class="form-control" required=""/>
            </div>
            <div class="form-group">
                <label for="image">Image <i class="bi bi-image"></i></label>
                <input type="URL" id="image" class="form-control" required=""/>
            </div>
            <div class="form-group">
                <label for="description">Description <i class="bi bi-info-circle"></i></label>
                <textarea id="description" class="form-control" rows="3" required=""></textarea>
            </div>
            <div class="form-group">
                <label for="specs">Specifications <i class="bi bi-list-ul"></i></label>
                <textarea id="specs" class="form-control" rows="3" required=""></textarea>
            </div>
            <button type="submit" class="btn btn-success">
                <i class="bi bi-plus-circle"></i> Add Product
            </button>
        </form>
        <button id="clear-storage" class="btn btn-danger">
            <i class="bi bi-trash"></i> Clear Storage
        </button>
        <h2 class="mt-4">Current Products</h2>
        <ul id="product-list" class="list-group"></ul>
    </div>

    <!-- Order Management Section -->
    <div id="orders-section" class="mt-5" style="display: none;">
        <h2>Pending Orders</h2>
        <ul id="order-list" class="list-group"></ul>
    </div>
</div>

<footer>
    <nav>
        <a href="#">About</a>-<a href="#">Privacy Policy</a>-<a href="#">Terms &amp; Policies</a>-<a href="#">Customer Service</a>
    </nav>
    <p>Â© AMA Stores, All Rights Reserved.</p>
</footer>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    const correctPassword = 'password';
    const base = 'https://server-zzwn.onrender.com'; // Define base URL for API
    let products = [];
    let orders = [];

    // Password authentication for admin access
    function checkPassword() {
        const password = prompt("Enter admin password:");
        if (password === correctPassword) {
            $('#admin-section').show();
            $('#orders-section').show();  // Show orders section as well
            fetchProducts();
            fetchOrders();  // Fetch orders after authentication
        } else {
            alert("Incorrect password. Access denied.");
        }
    }

    // Fetch products from the server
    function fetchProducts() {
        fetch(`${base}/products`)
            .then(response => response.json())
            .then(data => {
                products = data;
                renderProductList();
            })
            .catch(error => console.error('Error fetching products:', error));
    }

    // Fetch orders from the server
    function fetchOrders() {
        fetch(`${base}/orders`)
            .then(response => response.json())
            .then(data => {
                orders = data;
                renderOrderList(); // Render orders after fetching
            })
            .catch(error => console.error('Error fetching orders:', error));
    }

    // Add a new product
    function addProduct(category, name, price, stock, image, description, specs) {
        const newProduct = { category, name, price, stock, image, description, specs };
        fetch(`${base}/products`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(newProduct),
        })
        .then(response => {
            if (response.ok) {
                alert("Product added successfully!");
                fetchProducts(); // Refresh product list
            } else {
                alert("Error adding product.");
                return response.text().then(text => console.error(text));
            }
        })
        .catch(error => console.error('Error adding product:', error));
    }

    // Render the products list
    function renderProductList() {
        const productList = $('#product-list');
        productList.empty();
        products.forEach(product => {
            const listItem = $(`<li class="list-group-item d-flex justify-content-between align-items-center">
                ${product.name} - $${product.price}
                <button class="btn btn-danger btn-sm" onclick="deleteProduct('${product.id}')">Delete</button>
            </li>`);
            productList.append(listItem);
        });
    }

    // Delete a product
    function deleteProduct(productId) {
        $.ajax({
            url: `${base}/products/${productId}`,
            type: 'DELETE',
            success: function(response) {
                alert('Product deleted successfully!');
                fetchProducts(); // Refresh the product list
            },
            error: function(xhr, status, error) {
                alert('Error deleting product: ' + xhr.statusText);
            }
        });
    }

    // Mark an order as completed
    function completeOrder(orderId) {
        $.ajax({
            url: `${base}/orders/${orderId}`,
            type: 'PATCH',
            data: JSON.stringify({ status: 'completed' }),
            contentType: 'application/json',
            success: function(response) {
                alert('Order marked as completed!');
                fetchOrders();  // Refresh the order list
            },
            error: function(xhr, status, error) {
                alert('Error completing order: ' + xhr.statusText);
            }
        });
    }

    // Render the orders list
    function renderOrderList() {
        const orderList = $('#order-list');
        orderList.empty();
        orders.forEach(order => {
            const listItem = $(`<li class="list-group-item d-flex justify-content-between align-items-center">
                ${order.name} - ${order.phone} - ${order.location}
                <button class="btn btn-success btn-sm" onclick="completeOrder('${order.id}')">Complete</button>
            </li>`);
            orderList.append(listItem);
        });
    }

    $('#product-form').on('submit', function(event) {
        event.preventDefault();
        const category = $('#category').val();
        const name = $('#name').val();
        const price = parseFloat($('#price').val());
        const stock = parseInt($('#stock').val(), 10);
        const image = $('#image').val();
        const description = $('#description').val();
        const specs = $('#specs').val();

        addProduct(category, name, price, stock, image, description, specs);
        $('#product-form')[0].reset();
    });

    $('#clear-storage').on('click', function() {
        localStorage.clear();
        products = [];
        renderProductList();
        alert("Local storage cleared!");
    });

    checkPassword();
</script>

</body>
</html>
